{"ast":null,"code":"import{useEffect}from'react';export const TimelineMarker=_ref=>{let{adSegments}=_ref;useEffect(()=>{const injectTimelineMarkers=()=>{console.log('Attempting to inject markers...');// Wait for the YouTube player to be ready\nconst progressBar=document.querySelector('.ytp-progress-bar');const chaptersContainer=document.querySelector('.ytp-chapters-container');console.log('Found elements:',{progressBar,chaptersContainer});if(!progressBar||!chaptersContainer){console.log('Elements not found, retrying...');setTimeout(injectTimelineMarkers,1000);return;}// Clear any existing markers\nconst existingMarkers=document.querySelectorAll('.yt-adskip-marker');existingMarkers.forEach(marker=>marker.remove());// Get video duration from the progress bar\nconst duration=Number(progressBar.getAttribute('aria-valuemax'))||0;console.log('Video duration:',duration);if(!duration){console.log('No duration found, retrying...');setTimeout(injectTimelineMarkers,1000);return;}// Create container for markers if it doesn't exist\nlet markerContainer=document.querySelector('.yt-adskip-marker-container');if(!markerContainer){console.log('Creating new marker container');markerContainer=document.createElement('div');markerContainer.className='yt-adskip-marker-container';Object.assign(markerContainer.style,{position:'absolute',top:'0',left:'0',right:'0',bottom:'0',pointerEvents:'none',zIndex:'1'});chaptersContainer.appendChild(markerContainer);}console.log('Creating markers for segments:',adSegments);// Create markers for each ad segment\nadSegments.forEach(segment=>{if(!markerContainer)return;const marker=document.createElement('div');marker.className='yt-adskip-marker';// Calculate position and width\nconst startPercent=segment.start/duration*100;const endPercent=segment.end/duration*100;const width=endPercent-startPercent;console.log('Creating marker:',{startPercent,endPercent,width});// Style the marker\nObject.assign(marker.style,{position:'absolute',left:`${startPercent}%`,width:`${width}%`,top:'0',bottom:'0',backgroundColor:'rgba(255, 0, 0, 0.5)',pointerEvents:'none'});markerContainer.appendChild(marker);});// Verify markers were created\nconst createdMarkers=document.querySelectorAll('.yt-adskip-marker');console.log('Created markers count:',createdMarkers.length);};const setupSkipButton=()=>{// Remove any existing skip buttons\nconst existingButton=document.querySelector('.yt-adskip-button');if(existingButton)existingButton.remove();// Create skip button (hidden by default)\nconst skipButton=document.createElement('button');skipButton.className='yt-adskip-button ytp-button';skipButton.textContent='Skip Ad Section';skipButton.style.display='none';// Style the button\nObject.assign(skipButton.style,{position:'absolute',bottom:'60px',right:'20px',backgroundColor:'rgba(0, 0, 0, 0.7)',color:'white',border:'none',padding:'10px 20px',cursor:'pointer',zIndex:'2147483647',borderRadius:'4px'});// Add to player\nconst player=document.querySelector('.html5-video-player');if(player)player.appendChild(skipButton);// Monitor video time and show/hide skip button\nconst video=document.querySelector('video');if(!video)return;const checkAdSegment=()=>{const currentTime=video.currentTime;const activeSegment=adSegments.find(segment=>currentTime>=segment.start&&currentTime<segment.end);if(activeSegment){skipButton.style.display='block';skipButton.onclick=()=>{video.currentTime=activeSegment.end;skipButton.style.display='none';};}else{skipButton.style.display='none';}};video.addEventListener('timeupdate',checkAdSegment);};// Initial setup with retry mechanism\nconst setup=()=>{console.log('Running setup...');injectTimelineMarkers();setupSkipButton();};setup();// Re-run setup when navigating to a new video\nconst observer=new MutationObserver(mutations=>{for(const mutation of mutations){const target=mutation.target;if(target.nodeName==='VIDEO'||target instanceof Element&&target.classList.contains('ytp-progress-bar')){console.log('Detected video change, re-running setup');setup();break;}}});observer.observe(document.body,{childList:true,subtree:true,attributes:true,attributeFilter:['src','aria-valuemax']});return()=>{observer.disconnect();const video=document.querySelector('video');if(video){video.removeEventListener('timeupdate',()=>{});}};},[adSegments]);return null;};","map":{"version":3,"names":["useEffect","TimelineMarker","_ref","adSegments","injectTimelineMarkers","console","log","progressBar","document","querySelector","chaptersContainer","setTimeout","existingMarkers","querySelectorAll","forEach","marker","remove","duration","Number","getAttribute","markerContainer","createElement","className","Object","assign","style","position","top","left","right","bottom","pointerEvents","zIndex","appendChild","segment","startPercent","start","endPercent","end","width","backgroundColor","createdMarkers","length","setupSkipButton","existingButton","skipButton","textContent","display","color","border","padding","cursor","borderRadius","player","video","checkAdSegment","currentTime","activeSegment","find","onclick","addEventListener","setup","observer","MutationObserver","mutations","mutation","target","nodeName","Element","classList","contains","observe","body","childList","subtree","attributes","attributeFilter","disconnect","removeEventListener"],"sources":["C:/Users/ADAM/YT-adskip/YT-adskip-extension/src/components/TimelineMarker.tsx"],"sourcesContent":["import { useEffect } from 'react';\r\nimport { AdSegment } from '../utils/useVideoData';\r\n\r\ninterface TimelineMarkerProps {\r\n  adSegments: AdSegment[];\r\n}\r\n\r\nexport const TimelineMarker = ({ adSegments }: TimelineMarkerProps) => {\r\n  useEffect(() => {\r\n    const injectTimelineMarkers = () => {\r\n      console.log('Attempting to inject markers...');\r\n      \r\n      // Wait for the YouTube player to be ready\r\n      const progressBar = document.querySelector('.ytp-progress-bar');\r\n      const chaptersContainer = document.querySelector('.ytp-chapters-container');\r\n      \r\n      console.log('Found elements:', { progressBar, chaptersContainer });\r\n      \r\n      if (!progressBar || !chaptersContainer) {\r\n        console.log('Elements not found, retrying...');\r\n        setTimeout(injectTimelineMarkers, 1000);\r\n        return;\r\n      }\r\n\r\n      // Clear any existing markers\r\n      const existingMarkers = document.querySelectorAll('.yt-adskip-marker');\r\n      existingMarkers.forEach(marker => marker.remove());\r\n\r\n      // Get video duration from the progress bar\r\n      const duration = Number(progressBar.getAttribute('aria-valuemax')) || 0;\r\n      console.log('Video duration:', duration);\r\n      \r\n      if (!duration) {\r\n        console.log('No duration found, retrying...');\r\n        setTimeout(injectTimelineMarkers, 1000);\r\n        return;\r\n      }\r\n\r\n      // Create container for markers if it doesn't exist\r\n      let markerContainer = document.querySelector('.yt-adskip-marker-container') as HTMLDivElement | null;\r\n      if (!markerContainer) {\r\n        console.log('Creating new marker container');\r\n        markerContainer = document.createElement('div');\r\n        markerContainer.className = 'yt-adskip-marker-container';\r\n        Object.assign(markerContainer.style, {\r\n          position: 'absolute',\r\n          top: '0',\r\n          left: '0',\r\n          right: '0',\r\n          bottom: '0',\r\n          pointerEvents: 'none',\r\n          zIndex: '1'\r\n        });\r\n        chaptersContainer.appendChild(markerContainer);\r\n      }\r\n\r\n      console.log('Creating markers for segments:', adSegments);\r\n\r\n      // Create markers for each ad segment\r\n      adSegments.forEach(segment => {\r\n        if (!markerContainer) return;\r\n        \r\n        const marker = document.createElement('div');\r\n        marker.className = 'yt-adskip-marker';\r\n        \r\n        // Calculate position and width\r\n        const startPercent = (segment.start / duration) * 100;\r\n        const endPercent = (segment.end / duration) * 100;\r\n        const width = endPercent - startPercent;\r\n        \r\n        console.log('Creating marker:', { startPercent, endPercent, width });\r\n        \r\n        // Style the marker\r\n        Object.assign(marker.style, {\r\n          position: 'absolute',\r\n          left: `${startPercent}%`,\r\n          width: `${width}%`,\r\n          top: '0',\r\n          bottom: '0',\r\n          backgroundColor: 'rgba(255, 0, 0, 0.5)',\r\n          pointerEvents: 'none'\r\n        });\r\n        \r\n        markerContainer.appendChild(marker);\r\n      });\r\n\r\n      // Verify markers were created\r\n      const createdMarkers = document.querySelectorAll('.yt-adskip-marker');\r\n      console.log('Created markers count:', createdMarkers.length);\r\n    };\r\n\r\n    const setupSkipButton = () => {\r\n      // Remove any existing skip buttons\r\n      const existingButton = document.querySelector('.yt-adskip-button');\r\n      if (existingButton) existingButton.remove();\r\n\r\n      // Create skip button (hidden by default)\r\n      const skipButton = document.createElement('button');\r\n      skipButton.className = 'yt-adskip-button ytp-button';\r\n      skipButton.textContent = 'Skip Ad Section';\r\n      skipButton.style.display = 'none';\r\n      \r\n      // Style the button\r\n      Object.assign(skipButton.style, {\r\n        position: 'absolute',\r\n        bottom: '60px',\r\n        right: '20px',\r\n        backgroundColor: 'rgba(0, 0, 0, 0.7)',\r\n        color: 'white',\r\n        border: 'none',\r\n        padding: '10px 20px',\r\n        cursor: 'pointer',\r\n        zIndex: '2147483647',\r\n        borderRadius: '4px'\r\n      });\r\n\r\n      // Add to player\r\n      const player = document.querySelector('.html5-video-player') as HTMLElement;\r\n      if (player) player.appendChild(skipButton);\r\n\r\n      // Monitor video time and show/hide skip button\r\n      const video = document.querySelector('video') as HTMLVideoElement;\r\n      if (!video) return;\r\n\r\n      const checkAdSegment = () => {\r\n        const currentTime = video.currentTime;\r\n        const activeSegment = adSegments.find(\r\n          segment => currentTime >= segment.start && currentTime < segment.end\r\n        );\r\n\r\n        if (activeSegment) {\r\n          skipButton.style.display = 'block';\r\n          skipButton.onclick = () => {\r\n            video.currentTime = activeSegment.end;\r\n            skipButton.style.display = 'none';\r\n          };\r\n        } else {\r\n          skipButton.style.display = 'none';\r\n        }\r\n      };\r\n\r\n      video.addEventListener('timeupdate', checkAdSegment);\r\n    };\r\n\r\n    // Initial setup with retry mechanism\r\n    const setup = () => {\r\n      console.log('Running setup...');\r\n      injectTimelineMarkers();\r\n      setupSkipButton();\r\n    };\r\n    setup();\r\n\r\n    // Re-run setup when navigating to a new video\r\n    const observer = new MutationObserver((mutations) => {\r\n      for (const mutation of mutations) {\r\n        const target = mutation.target;\r\n        if (target.nodeName === 'VIDEO' || \r\n            (target instanceof Element && target.classList.contains('ytp-progress-bar'))) {\r\n          console.log('Detected video change, re-running setup');\r\n          setup();\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    observer.observe(document.body, {\r\n      childList: true,\r\n      subtree: true,\r\n      attributes: true,\r\n      attributeFilter: ['src', 'aria-valuemax']\r\n    });\r\n\r\n    return () => {\r\n      observer.disconnect();\r\n      const video = document.querySelector('video');\r\n      if (video) {\r\n        video.removeEventListener('timeupdate', () => {});\r\n      }\r\n    };\r\n  }, [adSegments]);\r\n\r\n  return null;\r\n}; "],"mappings":"AAAA,OAASA,SAAS,KAAQ,OAAO,CAOjC,MAAO,MAAM,CAAAC,cAAc,CAAGC,IAAA,EAAyC,IAAxC,CAAEC,UAAgC,CAAC,CAAAD,IAAA,CAChEF,SAAS,CAAC,IAAM,CACd,KAAM,CAAAI,qBAAqB,CAAGA,CAAA,GAAM,CAClCC,OAAO,CAACC,GAAG,CAAC,iCAAiC,CAAC,CAE9C;AACA,KAAM,CAAAC,WAAW,CAAGC,QAAQ,CAACC,aAAa,CAAC,mBAAmB,CAAC,CAC/D,KAAM,CAAAC,iBAAiB,CAAGF,QAAQ,CAACC,aAAa,CAAC,yBAAyB,CAAC,CAE3EJ,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAE,CAAEC,WAAW,CAAEG,iBAAkB,CAAC,CAAC,CAElE,GAAI,CAACH,WAAW,EAAI,CAACG,iBAAiB,CAAE,CACtCL,OAAO,CAACC,GAAG,CAAC,iCAAiC,CAAC,CAC9CK,UAAU,CAACP,qBAAqB,CAAE,IAAI,CAAC,CACvC,OACF,CAEA;AACA,KAAM,CAAAQ,eAAe,CAAGJ,QAAQ,CAACK,gBAAgB,CAAC,mBAAmB,CAAC,CACtED,eAAe,CAACE,OAAO,CAACC,MAAM,EAAIA,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,CAElD;AACA,KAAM,CAAAC,QAAQ,CAAGC,MAAM,CAACX,WAAW,CAACY,YAAY,CAAC,eAAe,CAAC,CAAC,EAAI,CAAC,CACvEd,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAEW,QAAQ,CAAC,CAExC,GAAI,CAACA,QAAQ,CAAE,CACbZ,OAAO,CAACC,GAAG,CAAC,gCAAgC,CAAC,CAC7CK,UAAU,CAACP,qBAAqB,CAAE,IAAI,CAAC,CACvC,OACF,CAEA;AACA,GAAI,CAAAgB,eAAe,CAAGZ,QAAQ,CAACC,aAAa,CAAC,6BAA6B,CAA0B,CACpG,GAAI,CAACW,eAAe,CAAE,CACpBf,OAAO,CAACC,GAAG,CAAC,+BAA+B,CAAC,CAC5Cc,eAAe,CAAGZ,QAAQ,CAACa,aAAa,CAAC,KAAK,CAAC,CAC/CD,eAAe,CAACE,SAAS,CAAG,4BAA4B,CACxDC,MAAM,CAACC,MAAM,CAACJ,eAAe,CAACK,KAAK,CAAE,CACnCC,QAAQ,CAAE,UAAU,CACpBC,GAAG,CAAE,GAAG,CACRC,IAAI,CAAE,GAAG,CACTC,KAAK,CAAE,GAAG,CACVC,MAAM,CAAE,GAAG,CACXC,aAAa,CAAE,MAAM,CACrBC,MAAM,CAAE,GACV,CAAC,CAAC,CACFtB,iBAAiB,CAACuB,WAAW,CAACb,eAAe,CAAC,CAChD,CAEAf,OAAO,CAACC,GAAG,CAAC,gCAAgC,CAAEH,UAAU,CAAC,CAEzD;AACAA,UAAU,CAACW,OAAO,CAACoB,OAAO,EAAI,CAC5B,GAAI,CAACd,eAAe,CAAE,OAEtB,KAAM,CAAAL,MAAM,CAAGP,QAAQ,CAACa,aAAa,CAAC,KAAK,CAAC,CAC5CN,MAAM,CAACO,SAAS,CAAG,kBAAkB,CAErC;AACA,KAAM,CAAAa,YAAY,CAAID,OAAO,CAACE,KAAK,CAAGnB,QAAQ,CAAI,GAAG,CACrD,KAAM,CAAAoB,UAAU,CAAIH,OAAO,CAACI,GAAG,CAAGrB,QAAQ,CAAI,GAAG,CACjD,KAAM,CAAAsB,KAAK,CAAGF,UAAU,CAAGF,YAAY,CAEvC9B,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAE,CAAE6B,YAAY,CAAEE,UAAU,CAAEE,KAAM,CAAC,CAAC,CAEpE;AACAhB,MAAM,CAACC,MAAM,CAACT,MAAM,CAACU,KAAK,CAAE,CAC1BC,QAAQ,CAAE,UAAU,CACpBE,IAAI,CAAE,GAAGO,YAAY,GAAG,CACxBI,KAAK,CAAE,GAAGA,KAAK,GAAG,CAClBZ,GAAG,CAAE,GAAG,CACRG,MAAM,CAAE,GAAG,CACXU,eAAe,CAAE,sBAAsB,CACvCT,aAAa,CAAE,MACjB,CAAC,CAAC,CAEFX,eAAe,CAACa,WAAW,CAAClB,MAAM,CAAC,CACrC,CAAC,CAAC,CAEF;AACA,KAAM,CAAA0B,cAAc,CAAGjC,QAAQ,CAACK,gBAAgB,CAAC,mBAAmB,CAAC,CACrER,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAEmC,cAAc,CAACC,MAAM,CAAC,CAC9D,CAAC,CAED,KAAM,CAAAC,eAAe,CAAGA,CAAA,GAAM,CAC5B;AACA,KAAM,CAAAC,cAAc,CAAGpC,QAAQ,CAACC,aAAa,CAAC,mBAAmB,CAAC,CAClE,GAAImC,cAAc,CAAEA,cAAc,CAAC5B,MAAM,CAAC,CAAC,CAE3C;AACA,KAAM,CAAA6B,UAAU,CAAGrC,QAAQ,CAACa,aAAa,CAAC,QAAQ,CAAC,CACnDwB,UAAU,CAACvB,SAAS,CAAG,6BAA6B,CACpDuB,UAAU,CAACC,WAAW,CAAG,iBAAiB,CAC1CD,UAAU,CAACpB,KAAK,CAACsB,OAAO,CAAG,MAAM,CAEjC;AACAxB,MAAM,CAACC,MAAM,CAACqB,UAAU,CAACpB,KAAK,CAAE,CAC9BC,QAAQ,CAAE,UAAU,CACpBI,MAAM,CAAE,MAAM,CACdD,KAAK,CAAE,MAAM,CACbW,eAAe,CAAE,oBAAoB,CACrCQ,KAAK,CAAE,OAAO,CACdC,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,WAAW,CACpBC,MAAM,CAAE,SAAS,CACjBnB,MAAM,CAAE,YAAY,CACpBoB,YAAY,CAAE,KAChB,CAAC,CAAC,CAEF;AACA,KAAM,CAAAC,MAAM,CAAG7C,QAAQ,CAACC,aAAa,CAAC,qBAAqB,CAAgB,CAC3E,GAAI4C,MAAM,CAAEA,MAAM,CAACpB,WAAW,CAACY,UAAU,CAAC,CAE1C;AACA,KAAM,CAAAS,KAAK,CAAG9C,QAAQ,CAACC,aAAa,CAAC,OAAO,CAAqB,CACjE,GAAI,CAAC6C,KAAK,CAAE,OAEZ,KAAM,CAAAC,cAAc,CAAGA,CAAA,GAAM,CAC3B,KAAM,CAAAC,WAAW,CAAGF,KAAK,CAACE,WAAW,CACrC,KAAM,CAAAC,aAAa,CAAGtD,UAAU,CAACuD,IAAI,CACnCxB,OAAO,EAAIsB,WAAW,EAAItB,OAAO,CAACE,KAAK,EAAIoB,WAAW,CAAGtB,OAAO,CAACI,GACnE,CAAC,CAED,GAAImB,aAAa,CAAE,CACjBZ,UAAU,CAACpB,KAAK,CAACsB,OAAO,CAAG,OAAO,CAClCF,UAAU,CAACc,OAAO,CAAG,IAAM,CACzBL,KAAK,CAACE,WAAW,CAAGC,aAAa,CAACnB,GAAG,CACrCO,UAAU,CAACpB,KAAK,CAACsB,OAAO,CAAG,MAAM,CACnC,CAAC,CACH,CAAC,IAAM,CACLF,UAAU,CAACpB,KAAK,CAACsB,OAAO,CAAG,MAAM,CACnC,CACF,CAAC,CAEDO,KAAK,CAACM,gBAAgB,CAAC,YAAY,CAAEL,cAAc,CAAC,CACtD,CAAC,CAED;AACA,KAAM,CAAAM,KAAK,CAAGA,CAAA,GAAM,CAClBxD,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAC,CAC/BF,qBAAqB,CAAC,CAAC,CACvBuC,eAAe,CAAC,CAAC,CACnB,CAAC,CACDkB,KAAK,CAAC,CAAC,CAEP;AACA,KAAM,CAAAC,QAAQ,CAAG,GAAI,CAAAC,gBAAgB,CAAEC,SAAS,EAAK,CACnD,IAAK,KAAM,CAAAC,QAAQ,GAAI,CAAAD,SAAS,CAAE,CAChC,KAAM,CAAAE,MAAM,CAAGD,QAAQ,CAACC,MAAM,CAC9B,GAAIA,MAAM,CAACC,QAAQ,GAAK,OAAO,EAC1BD,MAAM,WAAY,CAAAE,OAAO,EAAIF,MAAM,CAACG,SAAS,CAACC,QAAQ,CAAC,kBAAkB,CAAE,CAAE,CAChFjE,OAAO,CAACC,GAAG,CAAC,yCAAyC,CAAC,CACtDuD,KAAK,CAAC,CAAC,CACP,MACF,CACF,CACF,CAAC,CAAC,CAEFC,QAAQ,CAACS,OAAO,CAAC/D,QAAQ,CAACgE,IAAI,CAAE,CAC9BC,SAAS,CAAE,IAAI,CACfC,OAAO,CAAE,IAAI,CACbC,UAAU,CAAE,IAAI,CAChBC,eAAe,CAAE,CAAC,KAAK,CAAE,eAAe,CAC1C,CAAC,CAAC,CAEF,MAAO,IAAM,CACXd,QAAQ,CAACe,UAAU,CAAC,CAAC,CACrB,KAAM,CAAAvB,KAAK,CAAG9C,QAAQ,CAACC,aAAa,CAAC,OAAO,CAAC,CAC7C,GAAI6C,KAAK,CAAE,CACTA,KAAK,CAACwB,mBAAmB,CAAC,YAAY,CAAE,IAAM,CAAC,CAAC,CAAC,CACnD,CACF,CAAC,CACH,CAAC,CAAE,CAAC3E,UAAU,CAAC,CAAC,CAEhB,MAAO,KAAI,CACb,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}